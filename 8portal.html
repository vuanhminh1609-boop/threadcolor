<!doctype html>
<html lang="vi" data-world="nebula">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ThreadColor Universe â€¢ Portal Preview</title>
  <style>
    /* ---------- Reset + base ---------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial; color: rgba(255,255,255,.92); background:#050816; overflow-x:hidden}
    a{color:inherit; text-decoration:none}
    button,input{font:inherit}
    .wrap{max-width:1120px; margin:0 auto; padding:0 20px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:14px}
    .muted{color:rgba(255,255,255,.66)}
    .muted2{color:rgba(255,255,255,.55)}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .hidden{display:none!important}

    /* ---------- Tokens (default) ---------- */
    :root{
      --bg:#050816;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --glass:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.14);
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius:24px;
      --a1:34,211,238;
      --a2:236,72,153;
      --a3:139,92,246;
      --btnBg: linear-gradient(135deg, rgba(var(--a1),.22), rgba(var(--a2),.18), rgba(var(--a3),.18));
      --btnBorder: rgba(255,255,255,.18);
      --btnShadow: 0 0 26px rgba(var(--a1),.14), 0 0 36px rgba(var(--a2),.10);
    }
    html,body{background:var(--bg); color:var(--text)}

    /* ---------- Worlds ---------- */
    /* 1) Nebula */
    html[data-world="nebula"]{
      --bg:#050816;
      --glass:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.14);
      --a1:34,211,238; --a2:236,72,153; --a3:139,92,246;
    }
    /* 2) Arcade */
    html[data-world="arcade"]{
      --bg:#0b0614;
      --glass:rgba(0,0,0,.42);
      --stroke:rgba(255,255,255,.18);
      --a1:255,64,196; --a2:83,255,246; --a3:255,222,89;
      --btnBg: linear-gradient(90deg, rgba(255,64,196,.22), rgba(83,255,246,.18));
      --btnShadow: 0 0 0 2px rgba(255,255,255,.10) inset, 0 0 26px rgba(83,255,246,.10);
    }
    /* 3) Ink */
    html[data-world="ink"]{
      --bg:#fbfbf7;
      --text:rgba(10,14,40,.92);
      --muted:rgba(10,14,40,.62);
      --glass:rgba(255,255,255,.78);
      --stroke:rgba(10,14,40,.12);
      --a1:20,20,20; --a2:50,50,50; --a3:80,80,80;
      --btnBg: linear-gradient(90deg, rgba(10,14,40,.06), rgba(10,14,40,.04));
      --btnBorder: rgba(10,14,40,.14);
      --btnShadow: 0 12px 26px rgba(10,14,40,.10);
    }
    /* 4) Ocean */
    html[data-world="ocean"]{
      --bg:#020b16;
      --a1:64,224,208; --a2:59,130,246; --a3:34,197,94;
      --btnBg: linear-gradient(90deg, rgba(64,224,208,.18), rgba(59,130,246,.16));
    }
    /* 5) Dunes */
    html[data-world="dunes"]{
      --bg:#120a08;
      --a1:251,146,60; --a2:244,63,94; --a3:245,208,118;
      --btnBg: linear-gradient(135deg, rgba(251,146,60,.18), rgba(244,63,94,.14));
    }
    /* 6) Chrome */
    html[data-world="chrome"]{
      --bg:#06060a;
      --a1:200,200,255; --a2:255,255,255; --a3:180,180,200;
      --btnBg: linear-gradient(90deg, rgba(255,255,255,.14), rgba(200,200,255,.10));
      --btnShadow: 0 18px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.10) inset;
    }
    /* 7) Crystal */
    html[data-world="crystal"]{
      --bg:#040713;
      --a1:99,102,241; --a2:236,72,153; --a3:34,211,238;
      --btnBg: linear-gradient(135deg, rgba(99,102,241,.18), rgba(236,72,153,.14), rgba(34,211,238,.14));
    }
    /* 8) Origami */
    html[data-world="origami"]{
      --bg:#f7f8fb;
      --text:rgba(10,14,40,.92);
      --muted:rgba(10,14,40,.62);
      --glass:rgba(255,255,255,.78);
      --stroke:rgba(10,14,40,.10);
      --a1:59,130,246; --a2:239,68,68; --a3:234,179,8;
      --btnBg: linear-gradient(90deg, rgba(10,14,40,.92), rgba(10,14,40,.92));
      --btnBorder: rgba(10,14,40,.12);
      --btnShadow: 0 12px 26px rgba(10,14,40,.12);
    }

    /* ---------- Multiverse backgrounds (each totally different) ---------- */
    .bg-layer{position:fixed; inset:-20%; z-index:0; pointer-events:none; display:none}
    .bg-layer::before,.bg-layer::after{content:""; position:absolute; inset:0}
    html[data-world="nebula"] .bg-nebula,
    html[data-world="arcade"] .bg-arcade,
    html[data-world="ink"] .bg-ink,
    html[data-world="ocean"] .bg-ocean,
    html[data-world="dunes"] .bg-dunes,
    html[data-world="chrome"] .bg-chrome,
    html[data-world="crystal"] .bg-crystal,
    html[data-world="origami"] .bg-origami{display:block}

    .bg-nebula::before{
      background:
        radial-gradient(circle at 18% 25%, rgba(34,211,238,.40), transparent 58%),
        radial-gradient(circle at 82% 20%, rgba(236,72,153,.30), transparent 60%),
        radial-gradient(circle at 60% 82%, rgba(139,92,246,.28), transparent 62%),
        radial-gradient(circle at 40% 60%, rgba(255,255,255,.06), transparent 60%);
      filter: blur(64px);
      opacity:.95;
      animation: floaty 14s ease-in-out infinite alternate;
    }
    .bg-nebula::after{
      background:
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.75) 50%, transparent 52%),
        radial-gradient(1px 1px at 65% 18%, rgba(255,255,255,.60) 50%, transparent 52%),
        radial-gradient(1px 1px at 82% 45%, rgba(255,255,255,.55) 50%, transparent 52%),
        radial-gradient(1px 1px at 40% 72%, rgba(255,255,255,.45) 50%, transparent 52%);
      opacity:.22;
      mix-blend-mode: screen;
    }

    .bg-arcade::before{
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.08) 0px, rgba(255,255,255,.02) 1px, transparent 4px, transparent 10px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.06) 0px, rgba(255,255,255,.02) 1px, transparent 5px, transparent 14px),
        radial-gradient(circle at 18% 25%, rgba(255,64,196,.20), transparent 55%),
        radial-gradient(circle at 80% 30%, rgba(83,255,246,.16), transparent 60%),
        radial-gradient(circle at 50% 80%, rgba(255,222,89,.10), transparent 60%);
      opacity:.95;
    }
    .bg-arcade::after{
      background: linear-gradient(to bottom, transparent 0%, rgba(255,255,255,.06) 50%, transparent 100%);
      opacity:.18;
      animation: scan 2.8s linear infinite;
    }

    .bg-ink::before{
      background:
        radial-gradient(circle at 30% 35%, rgba(10,14,40,.10), transparent 60%),
        radial-gradient(circle at 75% 30%, rgba(10,14,40,.08), transparent 62%),
        radial-gradient(circle at 60% 82%, rgba(10,14,40,.07), transparent 62%),
        linear-gradient(180deg, rgba(10,14,40,.02), transparent 40%),
        #fbfbf7;
      opacity:.95;
    }
    .bg-ink::after{
      background:
        repeating-linear-gradient(0deg, rgba(10,14,40,.04) 0px, rgba(10,14,40,.04) 1px, transparent 6px, transparent 18px),
        repeating-linear-gradient(90deg, rgba(10,14,40,.03) 0px, rgba(10,14,40,.03) 1px, transparent 8px, transparent 22px);
      opacity:.10;
      mix-blend-mode: multiply;
    }

    .bg-ocean::before{
      background:
        radial-gradient(circle at 30% 20%, rgba(64,224,208,.22), transparent 60%),
        radial-gradient(circle at 70% 30%, rgba(59,130,246,.18), transparent 62%),
        radial-gradient(circle at 50% 80%, rgba(34,197,94,.12), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.05), transparent 40%);
      filter: blur(46px);
      opacity:.92;
    }
    .bg-ocean::after{
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.10), transparent 35%),
        radial-gradient(circle at 70% 40%, rgba(255,255,255,.08), transparent 38%),
        radial-gradient(circle at 50% 70%, rgba(255,255,255,.06), transparent 40%);
      mix-blend-mode: screen;
      opacity:.25;
      animation: caustics 6s ease-in-out infinite alternate;
    }

    .bg-dunes::before{
      background:
        radial-gradient(circle at 50% 22%, rgba(245,208,118,.22), transparent 52%),
        linear-gradient(180deg, rgba(251,146,60,.10), transparent 55%),
        radial-gradient(circle at 20% 75%, rgba(244,63,94,.12), transparent 60%),
        radial-gradient(circle at 80% 85%, rgba(251,146,60,.12), transparent 60%);
      filter: blur(40px);
      opacity:.95;
    }
    .bg-dunes::after{
      background:
        repeating-linear-gradient(160deg, rgba(255,255,255,.06) 0px, rgba(255,255,255,.02) 2px, transparent 7px, transparent 16px);
      opacity:.16;
      animation: wind 10s ease-in-out infinite alternate;
    }

    .bg-chrome::before{
      background:
        conic-gradient(from 220deg at 30% 30%, rgba(255,255,255,.18), rgba(200,200,255,.10), rgba(255,255,255,.16), rgba(180,180,200,.10), rgba(255,255,255,.18)),
        radial-gradient(circle at 70% 60%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(circle at 20% 80%, rgba(200,200,255,.10), transparent 60%);
      filter: blur(34px) saturate(1.25);
      opacity:.95;
      animation: chrome 9s ease-in-out infinite alternate;
    }
    .bg-chrome::after{
      background:
        linear-gradient(135deg, rgba(255,255,255,.05) 0%, transparent 35%, rgba(255,255,255,.04) 60%, transparent 100%);
      opacity:.14;
      mix-blend-mode: overlay;
    }

    .bg-crystal::before{
      background:
        conic-gradient(from 180deg at 40% 40%, rgba(99,102,241,.18), transparent 25%, rgba(236,72,153,.14), transparent 55%, rgba(34,211,238,.14), transparent 80%),
        conic-gradient(from 40deg at 70% 60%, rgba(34,211,238,.14), transparent 30%, rgba(236,72,153,.12), transparent 65%, rgba(99,102,241,.12), transparent 90%),
        radial-gradient(circle at 50% 80%, rgba(255,255,255,.06), transparent 60%);
      filter: blur(26px) saturate(1.2);
      opacity:.95;
      animation: crystal 12s ease-in-out infinite alternate;
    }
    .bg-crystal::after{
      background: linear-gradient(135deg, rgba(255,255,255,.06) 0%, transparent 35%, rgba(255,255,255,.05) 60%, transparent 100%);
      opacity:.12;
      mix-blend-mode: screen;
    }

    .bg-origami::before{
      background:
        linear-gradient(135deg, rgba(59,130,246,.10) 0%, transparent 42%),
        linear-gradient(225deg, rgba(239,68,68,.08) 0%, transparent 48%),
        radial-gradient(circle at 60% 75%, rgba(234,179,8,.10), transparent 55%),
        #f7f8fb;
      opacity:.92;
    }
    .bg-origami::after{
      background:
        linear-gradient(0deg, rgba(10,14,40,.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(10,14,40,.04) 1px, transparent 1px);
      background-size: 22px 22px, 22px 22px;
      opacity:.10;
    }

    @keyframes floaty{from{transform:translate3d(-2%,-1%,0) scale(1.02)}to{transform:translate3d(3%,2%,0) scale(1.06)}}
    @keyframes scan{from{transform:translateY(-30%)}to{transform:translateY(30%)}}
    @keyframes caustics{from{transform:translate3d(-2%,-1%,0) scale(1.05)}to{transform:translate3d(2.5%,1.5%,0) scale(1.12)}}
    @keyframes wind{from{transform:translateX(-1.5%) translateY(-1%)}to{transform:translateX(2%) translateY(1%)}}
    @keyframes chrome{from{transform:translate3d(-2%,-1%,0) rotate(-2deg) scale(1.05)}to{transform:translate3d(2.5%,1.5%,0) rotate(2deg) scale(1.12)}}
    @keyframes crystal{from{transform:translate3d(-1.5%,-1%,0) rotate(-1deg) scale(1.05)}to{transform:translate3d(2%,1.5%,0) rotate(1deg) scale(1.12)}}

    /* ---------- UI building blocks ---------- */
    .glass{
      background:var(--glass);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
    }
    /* Light worlds: adjust text & shadows */
    html[data-world="ink"] .glass, html[data-world="origami"] .glass{
      box-shadow: 0 18px 60px rgba(10,14,40,.10);
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding: 12px 16px;
      border-radius: 18px;
      border:1px solid var(--btnBorder);
      background: var(--btnBg);
      color: var(--text);
      box-shadow: var(--btnShadow);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter:saturate(1.05) }
    .btn:active{ transform: translateY(0px) scale(.99) }

    .btn-ghost{
      background: var(--glass);
      border:1px solid var(--stroke);
      box-shadow: none;
    }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: var(--glass);
      font-size: 12px;
    }

    .neon-text{
      /* Safe gradient text: if clip isn't supported, fallback to solid */
      color: rgb(var(--a1));
      background: linear-gradient(90deg, rgb(var(--a1)), rgb(var(--a2)), rgb(var(--a3)));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent; /* important */
      text-shadow: 0 0 18px rgba(var(--a1),.18);
    }

    /* ---------- Layout ---------- */
    header{position:relative; z-index:5; padding-top:18px}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:12px 14px; border-radius:18px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo{
      width:36px; height:36px; border-radius: 12px;
      display:flex; align-items:center; justify-content:center;
      background: var(--btnBg);
      border:1px solid var(--btnBorder);
      box-shadow: var(--btnShadow);
    }
    nav{display:flex; align-items:center; gap:8px}
    .navlink{padding:10px 12px; border-radius:14px; font-size:14px; opacity:.9}
    .navlink:hover{background: rgba(255,255,255,.05)}
    html[data-world="ink"] .navlink:hover, html[data-world="origami"] .navlink:hover{background: rgba(10,14,40,.05)}

    .hero{position:relative; z-index:4; padding: 64px 0 44px}
    .heroGrid{display:grid; grid-template-columns: 1.2fr .85fr; gap: 26px; align-items:center}
    @media (max-width: 920px){ .heroGrid{grid-template-columns: 1fr; gap: 18px} nav{display:none} }
    .h1{font-size: clamp(34px, 4.8vw, 60px); line-height: 1.05; margin: 14px 0 0}
    .lead{font-size: 18px; line-height:1.55; margin-top: 14px}
    .actions{display:flex; flex-wrap:wrap; gap:10px; margin-top: 18px}
    .tip{margin-top: 14px; font-size: 13px; color: var(--muted)}

    .core{padding:16px; border-radius: var(--radius); position:relative; overflow:hidden; isolation:isolate}
    .spot{
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at var(--mx,50%) var(--my,40%), rgba(var(--a1),.22), transparent 40%),
        radial-gradient(circle at 70% 30%, rgba(var(--a2),.16), transparent 45%),
        radial-gradient(circle at 55% 85%, rgba(var(--a3),.14), transparent 45%);
      filter: blur(18px);
      opacity:.85;
      pointer-events:none;
      z-index:0;
      transform: translateZ(0);
    }
    .coreInner{position:relative; z-index:1; padding:16px; border-radius: 18px; background: var(--glass); border:1px solid var(--stroke)}
    .coreTop{display:flex; align-items:center; justify-content:space-between}
    .swatch{width: 86px; height: 86px; border-radius: 18px; border:1px solid var(--btnBorder); background: var(--btnBg); box-shadow: var(--btnShadow)}
    .coreRow{display:flex; gap:14px; align-items:center; margin-top: 14px}
    .coreTitle{font-weight:700; font-size: 18px}
    .miniChips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .miniChips .chip{border-radius: 14px}
    .miniGrid{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top: 14px}
    .miniCard{padding:12px; border-radius: 16px; background: var(--glass); border:1px solid var(--stroke)}
    .miniCard b{display:block; margin-top:6px}

    /* ---------- Worlds menu ---------- */
    .menuWrap{position:relative}
    .menu{position:absolute; right:0; top: calc(100% + 10px); min-width: 280px; padding:10px; border-radius: 18px}
    .menu button{width:100%; text-align:left; padding:10px 10px; border-radius: 14px; border:0; background:transparent; color:inherit; cursor:pointer}
    .menu button:hover{background: rgba(255,255,255,.05)}
    html[data-world="ink"] .menu button:hover, html[data-world="origami"] .menu button:hover{background: rgba(10,14,40,.05)}
    .menu .sep{height:1px; background: rgba(255,255,255,.10); margin: 8px 0}
    html[data-world="ink"] .menu .sep, html[data-world="origami"] .menu .sep{background: rgba(10,14,40,.10)}

    /* ---------- World Gallery modal ---------- */
    .modal{position:fixed; inset:0; z-index:9999}
    .backdrop{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 30% 20%, rgba(var(--a1),.18), transparent 55%),
        radial-gradient(circle at 70% 30%, rgba(var(--a2),.14), transparent 55%),
        radial-gradient(circle at 55% 80%, rgba(var(--a3),.12), transparent 55%),
        rgba(0,0,0,.62);
    }
    html[data-world="ink"] .backdrop, html[data-world="origami"] .backdrop{
      background:
        radial-gradient(circle at 30% 20%, rgba(10,14,40,.10), transparent 55%),
        radial-gradient(circle at 70% 30%, rgba(10,14,40,.08), transparent 55%),
        rgba(10,14,40,.18);
    }
    .modalCard{position:relative; z-index:2; max-width: 1180px; margin: 22px auto; padding: 14px; border-radius: 28px}
    .modalHead{display:flex; flex-wrap:wrap; justify-content:space-between; gap:12px; align-items:center; padding: 8px}
    .title{font-weight:800; font-size: 22px}
    .sub{font-size: 13px; color: var(--muted)}
    .controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .search{padding:10px 12px; border-radius: 999px; border:1px solid var(--stroke); background: var(--glass); outline:none; min-width: 260px; color:inherit}
    .tog{display:flex; align-items:center; gap:8px; padding: 10px 12px; border-radius: 999px; border:1px solid var(--stroke); background: var(--glass); font-size: 12px}
    .filters{display:flex; flex-wrap:wrap; gap:8px; padding: 6px 8px 0}
    .fbtn{padding:8px 12px; border-radius: 999px; border:1px solid var(--stroke); background: var(--glass); cursor:pointer; font-size: 12px}
    .fbtn.active{background: rgba(var(--a1),.10); border-color: rgba(var(--a1),.20)}
    .grid{display:grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 12px 8px 8px}
    @media (max-width: 1020px){ .grid{grid-template-columns: repeat(3,1fr)} }
    @media (max-width: 760px){ .grid{grid-template-columns: repeat(2,1fr)} .search{min-width: 200px} }
    @media (max-width: 460px){ .grid{grid-template-columns: 1fr} }
    .card{
      position:relative;
      padding: 12px;
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: var(--glass);
      cursor:pointer;
      overflow:hidden;
      transform-style: preserve-3d;
      perspective: 900px;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .card:hover{
      box-shadow: 0 18px 60px rgba(0,0,0,.35), 0 0 32px rgba(var(--a1),.14);
      transform: translateY(-2px);
    }
    .mini{height: 92px; border-radius: 18px; border:1px solid rgba(255,255,255,.10)}
    html[data-world="ink"] .mini, html[data-world="origami"] .mini{border-color: rgba(10,14,40,.10)}
    .cname{font-weight:800; margin-top: 10px}
    .cdesc{font-size: 13px; color: var(--muted); margin-top:6px; line-height:1.4}
    .badge{position:absolute; left:12px; top:12px; padding:6px 10px; border-radius: 999px; border:1px solid var(--stroke); background: rgba(0,0,0,.22); font-size: 11px}
    html[data-world="ink"] .badge, html[data-world="origami"] .badge{background: rgba(255,255,255,.65)}
    .fav{position:absolute; right:12px; top:12px; width:34px; height:34px; border-radius:999px; border:1px solid var(--stroke); background: rgba(0,0,0,.22); display:flex; align-items:center; justify-content:center; font-size: 16px; opacity:.88}
    html[data-world="ink"] .fav, html[data-world="origami"] .fav{background: rgba(255,255,255,.65)}
    .fav.active{background: rgba(var(--a2),.18); box-shadow: 0 0 26px rgba(var(--a2),.14)}

    /* ---------- Enter overlay ---------- */
    .enter{position:fixed; inset:0; z-index:100000; pointer-events:none}
    .enterBg{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 50% 50%, rgba(var(--a1),.18), transparent 40%),
        radial-gradient(circle at 55% 55%, rgba(var(--a2),.16), transparent 45%),
        radial-gradient(circle at 45% 60%, rgba(var(--a3),.14), transparent 45%),
        rgba(0,0,0,.78);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .enterRing{
      position:absolute; inset:0;
      background: radial-gradient(circle at 50% 50%, transparent 28%, rgba(255,255,255,.12) 29%, transparent 32%, rgba(255,255,255,.08) 33%, transparent 40%);
      opacity:0; transform: scale(.7);
    }
    .enterText{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:10px; opacity:0; transform: translateY(10px) scale(.98)}
    .enterText .t1{letter-spacing:.32em; font-weight:800; font-size:12px; opacity:.9}
    .enterText .t2{font-weight:900; font-size:28px}
    .enter.show .enterText{animation: enterText .62s ease forwards}
    .enter.show .enterRing{animation: enterRing .62s ease forwards}
    @keyframes enterText{0%{opacity:0;transform:translateY(10px) scale(.98)}55%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-6px) scale(1.02)}}
    @keyframes enterRing{0%{opacity:0;transform:scale(.72)}60%{opacity:.75;transform:scale(1.1)}100%{opacity:0;transform:scale(1.6)}}

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important; transition:none!important}
    }
  
/* ===================== Addictive-but-ethical v3 (Playful Loop) ===================== */
/* Micro FX on world cards (each feels alive) */
.mini{ position:relative; overflow:hidden; isolation:isolate; }
.mini::after{
  content:"";
  position:absolute; inset:-20%;
  opacity:.0;
  transform: translate3d(0,0,0);
  transition: opacity .14s ease;
  pointer-events:none;
}
.card:hover .mini::after{ opacity:.95; }

/* pointer spotlight shared */
.card{ --px:50%; --py:40%; }
.mini::before{
  content:"";
  position:absolute; inset:-10%;
  background: radial-gradient(circle at var(--px) var(--py), rgba(255,255,255,.14), transparent 45%);
  opacity:.0;
  transition: opacity .14s ease;
  pointer-events:none;
  mix-blend-mode: screen;
}
.card:hover .mini::before{ opacity:.65; }

/* World-specific overlays */
.card[data-world="nebula"] .mini::after{
  background:
    radial-gradient(1px 1px at 18% 30%, rgba(255,255,255,.85) 60%, transparent 62%),
    radial-gradient(1px 1px at 70% 22%, rgba(255,255,255,.65) 60%, transparent 62%),
    radial-gradient(1px 1px at 82% 60%, rgba(255,255,255,.55) 60%, transparent 62%),
    radial-gradient(circle at 30% 30%, rgba(var(--a1),.20), transparent 55%),
    radial-gradient(circle at 80% 45%, rgba(var(--a2),.16), transparent 60%);
  filter: blur(0px);
  animation: twinkle 2.6s ease-in-out infinite alternate;
  mix-blend-mode: screen;
}
@keyframes twinkle{ from{transform:translateY(-1%)} to{transform:translateY(1.5%)} }

.card[data-world="arcade"] .mini::after{
  background:
    repeating-linear-gradient(0deg, rgba(255,255,255,.10) 0px, rgba(255,255,255,.03) 1px, transparent 4px, transparent 10px),
    linear-gradient(to bottom, transparent 0%, rgba(255,255,255,.10) 50%, transparent 100%);
  animation: scanMini 1.9s linear infinite;
  opacity:.9;
}
@keyframes scanMini{ from{transform:translateY(-25%)} to{transform:translateY(25%)} }

.card[data-world="ink"] .mini::after{
  background:
    radial-gradient(circle at 30% 40%, rgba(10,14,40,.12), transparent 55%),
    radial-gradient(circle at 70% 55%, rgba(10,14,40,.10), transparent 60%),
    radial-gradient(circle at 55% 80%, rgba(10,14,40,.07), transparent 60%);
  mix-blend-mode: multiply;
  animation: inkBloom 3.6s ease-in-out infinite alternate;
}
@keyframes inkBloom{ from{transform:scale(1.02)} to{transform:scale(1.08)} }

.card[data-world="ocean"] .mini::after{
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), transparent 45%),
    radial-gradient(circle at 60% 45%, rgba(255,255,255,.10), transparent 50%),
    radial-gradient(circle at 50% 70%, rgba(255,255,255,.08), transparent 55%);
  mix-blend-mode: screen;
  animation: causticMini 2.8s ease-in-out infinite alternate;
}
@keyframes causticMini{ from{transform:translate3d(-2%,-1%,0) scale(1.05)} to{transform:translate3d(2.5%,1.5%,0) scale(1.12)} }

.card[data-world="dunes"] .mini::after{
  background:
    repeating-linear-gradient(160deg, rgba(255,255,255,.08) 0px, rgba(255,255,255,.02) 2px, transparent 7px, transparent 16px);
  opacity:.55;
  animation: windMini 2.8s ease-in-out infinite alternate;
}
@keyframes windMini{ from{transform:translateX(-3%)} to{transform:translateX(3%)} }

.card[data-world="chrome"] .mini::after{
  background:
    linear-gradient(120deg, transparent 0%, rgba(255,255,255,.18) 35%, transparent 70%);
  mix-blend-mode: screen;
  opacity:.0;
  animation: sheen 1.6s ease-in-out infinite;
}
.card:hover[data-world="chrome"] .mini::after{ opacity:.75; }
@keyframes sheen{ from{transform:translateX(-40%)} to{transform:translateX(40%)} }

.card[data-world="crystal"] .mini::after{
  background:
    conic-gradient(from 180deg at 50% 50%, rgba(255,255,255,.10), transparent 25%, rgba(255,255,255,.08), transparent 60%, rgba(255,255,255,.10));
  mix-blend-mode: screen;
  animation: prism 3.2s ease-in-out infinite alternate;
}
@keyframes prism{ from{transform:rotate(-6deg) scale(1.05)} to{transform:rotate(6deg) scale(1.12)} }

.card[data-world="origami"] .mini::after{
  background:
    linear-gradient(0deg, rgba(10,14,40,.06) 1px, transparent 1px),
    linear-gradient(90deg, rgba(10,14,40,.05) 1px, transparent 1px);
  background-size: 18px 18px, 18px 18px;
  mix-blend-mode: multiply;
  opacity:.25;
  animation: paperShift 3.2s ease-in-out infinite alternate;
}
@keyframes paperShift{ from{transform:translate(-1%,-1%)} to{transform:translate(1.5%,1%)} }

/* Toast */
.tc-toast{
  position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
  z-index: 100001;
  padding: 10px 12px;
  border-radius: 999px;
  border: 1px solid var(--stroke);
  background: rgba(0,0,0,.42);
  color: var(--text);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 18px 60px rgba(0,0,0,.35);
  opacity:0; pointer-events:none;
  transition: opacity .18s ease, transform .18s ease;
}
html[data-world="ink"] .tc-toast, html[data-world="origami"] .tc-toast{
  background: rgba(255,255,255,.82);
  color: rgba(10,14,40,.92);
  box-shadow: 0 18px 60px rgba(10,14,40,.12);
}
.tc-toast.show{ opacity:1; transform: translateX(-50%) translateY(-6px); }

/* Roulette modal */
.rmodal{ position:fixed; inset:0; z-index: 9998; }
.rback{ position:absolute; inset:0; background: rgba(0,0,0,.62); }
.rpanel{ position:relative; z-index:2; max-width: 860px; margin: 22px auto; padding: 14px; border-radius: 28px; }
.rgrid{ display:grid; grid-template-columns: 1fr .9fr; gap: 12px; padding: 8px; }
@media (max-width: 900px){ .rgrid{ grid-template-columns: 1fr; } }
.rpreview{ height: 220px; border-radius: 22px; border: 1px solid var(--stroke); overflow:hidden; position:relative; }
.rpreview::after{ content:""; position:absolute; inset:0; background: radial-gradient(circle at 20% 30%, rgba(255,255,255,.12), transparent 40%); mix-blend-mode: screen; }
.rmeta{ padding: 12px; border-radius: 22px; border:1px solid var(--stroke); background: var(--glass); }
.kv{ display:flex; justify-content:space-between; gap:10px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,.08); }
html[data-world="ink"] .kv, html[data-world="origami"] .kv{ border-bottom-color: rgba(10,14,40,.10); }
.kv:last-child{ border-bottom:0; }
.small{ font-size: 12px; color: var(--muted); }
.copy{ cursor:pointer; user-select:none; }
.copy:hover{ text-decoration: underline; }
.progress{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.10); overflow:hidden; }
html[data-world="ink"] .progress, html[data-world="origami"] .progress{ background: rgba(10,14,40,.06); border-color: rgba(10,14,40,.10); }
.progress > i{ display:block; height:100%; width: 0%; background: linear-gradient(90deg, rgba(var(--a1),.9), rgba(var(--a2),.85), rgba(var(--a3),.85)); border-radius:999px; }


/* Background parallax (subtle) */
:root{ --pdx: 0px; --pdy: 0px; }
.bg-layer{ transform: translate(var(--pdx), var(--pdy)); transition: transform .22s ease; }
@media (prefers-reduced-motion: reduce){
  .bg-layer{ transition:none!important; transform:none!important; }
}

</style>

  <script>
    (function(){
      const KEY = "tc_world";
      const urlWorld = new URLSearchParams(location.search).get("world") || new URLSearchParams(location.search).get("theme");
      const DEFAULT = "nebula";

      function systemDefault(){
        return (window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches) ? "origami" : DEFAULT;
      }
      function apply(world){
        document.documentElement.setAttribute("data-world", world || DEFAULT);
      }

      const saved = localStorage.getItem(KEY);
      const initial = urlWorld || saved || systemDefault();
      apply(initial);

      window.__tcSetWorld = function(w){ localStorage.setItem(KEY, w); apply(w); };
      window.__tcApplyWorld = function(w){ apply(w); };
      window.__tcGetWorld = function(){ return document.documentElement.getAttribute("data-world") || DEFAULT; };
      window.__tcHasSavedWorld = function(){ return !!localStorage.getItem(KEY); };
      window.__tcClearWorld = function(){ localStorage.removeItem(KEY); apply(systemDefault()); };

      // debug helper for users who can't access devtools
      window.__tcNuke = function(){ localStorage.removeItem(KEY); localStorage.removeItem("tc_world_favs"); location.reload(); };
    })();
  </script>
</head>

<body>
  <!-- Backgrounds -->
  <div class="bg-layer bg-nebula"></div>
  <div class="bg-layer bg-arcade"></div>
  <div class="bg-layer bg-ink"></div>
  <div class="bg-layer bg-ocean"></div>
  <div class="bg-layer bg-dunes"></div>
  <div class="bg-layer bg-chrome"></div>
  <div class="bg-layer bg-crystal"></div>
  <div class="bg-layer bg-origami"></div>

  <!-- Enter overlay -->
  <div id="tcEnter" class="enter hidden">
    <div class="enterBg"></div>
    <div class="enterRing"></div>
    <div class="enterText">
      <div class="t1">ENTERING</div>
      <div class="t2">Color Space</div>
    </div>
  </div>

  <header class="wrap">
    <div class="glass topbar">
      <div class="brand">
        <div class="logo">ğŸ¨</div>
        <div>
          <div style="font-weight:800; letter-spacing:.02em">ThreadColor Universe</div>
          <div class="muted2" style="font-size:12px">Portal preview â€¢ multiverse themes</div>
        </div>
      </div>

      <nav>
        <a class="navlink" href="#gateway">Gateway</a>
        <a class="navlink" href="#features">TÃ­nh nÄƒng</a>
        <a class="navlink" href="#community">Community</a>

        <div class="menuWrap">
          <button id="worldBtn" class="btn btn-ghost" style="padding:10px 12px; border-radius:14px">ğŸª Worlds</button>
          <div id="worldMenu" class="glass menu hidden" role="menu">
            <button id="openGallery">âœ¨ World Gallery (Enter a universe)</button>
            <div class="sep"></div>
            <button data-w="nebula">ğŸŒŒ Nebula Gate</button>
            <button data-w="arcade">ğŸ•¹ Pixel Arcade</button>
            <button data-w="ink">ğŸ–‹ Ink Wash</button>
            <button data-w="ocean">ğŸŒŠ Underwater</button>
            <button data-w="dunes">ğŸœ Desert Dunes</button>
            <button data-w="chrome">ğŸª Liquid Chrome</button>
            <button data-w="crystal">ğŸ’ Crystal Cave</button>
            <button data-w="origami">ğŸ§© Origami City</button>
            <div class="sep"></div>
            <button id="resetWorld">â†© Reset</button>
          </div>
        </div>
      </nav>

      <div style="display:flex; gap:10px; align-items:center">
        <button id="mobileWorld" class="btn btn-ghost" style="padding:10px 12px; border-radius:14px">ğŸª</button>
        <a class="btn" href="app.html" style="padding:10px 12px; border-radius:14px">Má»Ÿ Tool</a>
      </div>
    </div>
  </header>

  <main class="wrap hero">
    <div class="heroGrid">
      <div>
        <div class="chip"><span style="width:8px;height:8px;border-radius:999px;background:rgba(var(--a1),.9);display:inline-block"></span> Beta Universe â€¢ Build in public</div>

        <h1 class="h1">
          BÆ°á»›c vÃ o <span class="neon-text">Tháº¿ giá»›i KhÃ´ng gian MÃ u sá»‘</span>
        </h1>

        <p class="lead muted">
          Má»™t â€œvÅ© trá»¥â€ cho mÃ u sáº¯c: tra mÃ£ chá»‰ tá»« HEX/Pantone, táº¡o palette, chÆ¡i vá»›i gradient,
          lÆ°u thÆ° viá»‡n cÃ¡ nhÃ¢n, chia sáº» â€” vÃ  sau nÃ y lÃ  â€œmÃ£ chá»‰ phá»• biáº¿nâ€ do cá»™ng Ä‘á»“ng chá»n.
        </p>

        <div class="actions">
          <a class="btn" href="app.html"><span>ğŸš€</span><span>Báº¯t Ä‘áº§u tra mÃ£</span></a>
          <a class="btn btn-ghost" href="#gateway"><span>ğŸª</span><span>KhÃ¡m phÃ¡ cÃ¡c cá»•ng</span></a>
          <button class="btn btn-ghost" id="tryGallery"><span>âœ¨</span><span>Chá»n vÅ© trá»¥</span></button>
          <button class="btn" id="openRoulette"><span>ğŸ°</span><span>Gradient Roulette</span></button>
          <button class="btn btn-ghost" id="openForge"><span>ğŸ§ª</span><span>Palette Forge</span></button>
        </div>

        <div class="tip">
          Tip: Home cÃ³ thá»ƒ lÃ  â€œtÄ©nhâ€ (landing), cÃ²n cÃ¡c pháº§n cá»™ng Ä‘á»“ng (My Library / Popular Picks / Chat) lÃ  â€œÄ‘á»™ngâ€ phÃ­a backend.
        </div>

        <div class="glass" style="margin-top:14px; padding:12px 14px; border-radius:18px">
          <div class="row" style="align-items:flex-start">
            <div style="flex:1">
              <div style="font-weight:800">Collection</div>
              <div class="small">KhÃ¡m phÃ¡ Ä‘á»§ 8 vÅ© trá»¥ Ä‘á»ƒ má»Ÿ â€œDaily Stampâ€ (optâ€‘in). KhÃ´ng Ã©p, chá»‰ Ä‘á»ƒ vui.</div>
              <div style="margin-top:10px" class="progress"><i id="seenBar"></i></div>
              <div class="small" style="margin-top:8px"><span id="seenText">0</span>/8 worlds discovered</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
              <button class="btn btn-ghost" id="claimDaily" style="padding:10px 12px; border-radius:999px">ğŸ—“ Claim daily stamp</button>
              <button class="btn btn-ghost" id="clearLoop" style="padding:10px 12px; border-radius:999px">ğŸ§¹ Reset loop</button>
            </div>
          </div>
        </div>

      </div>

      <div>
        <div class="glass core" id="coreCard">
          <div class="spot" id="spot"></div>

          <div class="coreInner">
            <div class="coreTop">
              <div>
                <div style="font-size:14px" class="muted">Spectrum Core</div>
                <div style="font-size:12px" class="muted2">Háº¡t nhÃ¢n mÃ u â€” render realtime</div>
              </div>
              <div class="chip" style="border-radius:12px">LIVE</div>
            </div>

            <div class="coreRow">
              <div class="swatch" id="heroSwatch" aria-label="Color swatch"></div>
              <div style="flex:1">
                <div class="coreTitle">Aurora Sample</div>
                <div class="muted" style="font-size:14px">HEX:
                  <span class="mono" id="heroHex">#22d3ee</span>
                </div>
                <div class="miniChips">
                  <span class="chip" style="border-radius:14px">Thread Atlas</span>
                  <span class="chip" style="border-radius:14px">Î”E Match</span>
                  <span class="chip" style="border-radius:14px">Brand Filters</span>
                </div>
              </div>
            </div>

            <div class="miniGrid">
              <div class="miniCard">
                <div class="muted2" style="font-size:12px">Nearest</div>
                <b>Gingko Y3199</b>
                <div class="muted2" style="font-size:12px">Î”E 1.2</div>
              </div>
              <div class="miniCard">
                <div class="muted2" style="font-size:12px">Runner-up</div>
                <b>MS 233</b>
                <div class="muted2" style="font-size:12px">Î”E 1.7</div>
              </div>
              <div class="miniCard">
                <div class="muted2" style="font-size:12px">Alt</div>
                <b>Anchor 260</b>
                <div class="muted2" style="font-size:12px">Î”E 2.1</div>
              </div>
            </div>

            <div class="muted2" style="margin-top:10px; font-size:12px">(Mock data Ä‘á»ƒ preview cáº£m giÃ¡c. Ná»‘i dá»¯ liá»‡u tháº­t sau.)</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <section class="wrap" id="gateway" style="position:relative; z-index:4; padding: 8px 0 18px">
    <div class="glass" style="padding:18px">
      <div style="font-weight:900; font-size:18px">Gateway</div>
      <div class="muted" style="margin-top:6px">Landing nÃ y lÃ  â€œcá»•ng vÃ oâ€. CÃ¡c cá»•ng tháº­t: HEX â†’ thread codes, Pantone â†’ match, Pick tá»« áº£nh, My Library, Popular Picksâ€¦</div>
    </div>
  </section>

  <section class="wrap" id="features" style="position:relative; z-index:4; padding: 10px 0 18px">
    <div class="glass" style="padding:18px">
      <div style="font-weight:900; font-size:18px">TÃ­nh nÄƒng</div>
      <div class="muted" style="margin-top:6px">Chá»— nÃ y báº¡n cÃ³ thá»ƒ trÆ°ng bÃ y 6â€“8 â€œcá»•ngâ€ nhÆ° web lá»›n: Tra mÃ u, Palette, Gradient, Library, Crowd picks, Chatâ€¦</div>
    </div>
  </section>

  <section class="wrap" id="community" style="position:relative; z-index:4; padding: 10px 0 50px">
    <div class="glass" style="padding:18px">
      <div style="font-weight:900; font-size:18px">Community</div>
      <div class="muted" style="margin-top:6px">Sau nÃ y: user login, lÆ°u library, Ä‘Ã³ng gÃ³p mÃ u, vote â€œmÃ£ chá»‰ phá»• biáº¿nâ€, chat nhÃ³mâ€¦</div>
    </div>
  </section>


  <!-- Gradient Roulette (playful, opt-in) -->
  <div id="rouletteModal" class="rmodal hidden" role="dialog" aria-modal="true" aria-label="Gradient Roulette">
    <div class="rback" id="rouletteCloseBack"></div>
    <div class="glass rpanel">
      <div class="row" style="padding: 8px 8px 0">
        <div>
          <div class="title">ğŸ° Gradient Roulette</div>
          <div class="sub">Spin Ä‘á»ƒ ra 1 gradient â€œÄ‘Ã£ máº¯tâ€. Báº¡n cÃ³ thá»ƒ copy HEX / CSS, hoáº·c lÆ°u local (mock).</div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
          <button class="btn btn-ghost" id="rouletteCopy" style="padding:10px 12px; border-radius:999px">ğŸ“‹ Copy CSS</button>
          <button class="btn btn-ghost" id="rouletteSave" style="padding:10px 12px; border-radius:999px">ğŸ’¾ Save (local)</button>
          <button class="btn" id="rouletteClose" style="padding:10px 12px; border-radius:999px">ÄÃ³ng</button>
        </div>
      </div>

      <div class="rgrid">
        <div class="rpreview" id="roulettePreview"></div>
        <div class="rmeta">
          <div class="kv"><span class="small">Gradient</span><span class="mono copy" id="rouletteCss">linear-gradient(...)</span></div>
          <div class="kv"><span class="small">Stops</span><span class="mono" id="rouletteStops">#000 â€¢ #000 â€¢ #000</span></div>
          <div class="kv"><span class="small">Vibe</span><span id="rouletteVibe">â€”</span></div>
          <div class="kv"><span class="small">Mock thread pick</span><span id="rouletteThread">â€”</span></div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px">
            <button class="btn" id="rouletteSpin" style="flex:1">SPIN âœ¨</button>
            <button class="btn btn-ghost" id="rouletteSpinSoft" style="flex:1">Soft spin</button>
          </div>
          <div class="small" style="margin-top:10px">Má»¥c tiÃªu: vui vÃ  â€œÄ‘Ã£ máº¯tâ€, khÃ´ng Ã©p báº¡n á»Ÿ láº¡i. Báº¡n cÃ³ thá»ƒ táº¯t báº±ng Reset loop.</div>
        </div>
      </div>
    </div>
  </div>

  <div id="tcToast" class="tc-toast">Saved</div>


  
  <!-- Palette Forge (creative loop, opt-in) -->
  <div id="forgeModal" class="rmodal hidden" role="dialog" aria-modal="true" aria-label="Palette Forge">
    <div class="rback" id="forgeCloseBack"></div>
    <div class="glass rpanel">
      <div class="row" style="padding: 8px 8px 0">
        <div>
          <div class="title">ğŸ§ª Palette Forge</div>
          <div class="sub">Táº¡o palette 5 mÃ u tá»« gradient hiá»‡n táº¡i â€¢ Copy nhanh â€¢ Save local (mock)</div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
          <button class="btn btn-ghost" id="forgeCopyHex" style="padding:10px 12px; border-radius:999px">ğŸ“‹ Copy HEX</button>
          <button class="btn btn-ghost" id="forgeCopyJson" style="padding:10px 12px; border-radius:999px">ğŸ§¾ Copy JSON</button>
          <button class="btn" id="forgeClose" style="padding:10px 12px; border-radius:999px">ÄÃ³ng</button>
        </div>
      </div>

      <div class="rgrid">
        <div class="rpreview" id="forgePreview"></div>
        <div class="rmeta">
          <div class="kv"><span class="small">Source</span><span id="forgeSource">Current gradient</span></div>
          <div class="kv"><span class="small">Tip</span><span class="small">Click swatch Ä‘á»ƒ copy</span></div>

          <div style="display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; margin-top:12px" id="forgeSwatches"></div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px">
            <button class="btn" id="forgeFromGradient" style="flex:1">From current gradient âœ¨</button>
            <button class="btn btn-ghost" id="forgeShuffle" style="flex:1">Shuffle</button>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
            <button class="btn btn-ghost" id="forgeSave" style="flex:1">ğŸ’¾ Save palette (local)</button>
            <button class="btn btn-ghost" id="forgeViewSaves" style="flex:1">ğŸ“š View saved</button>
          </div>

          <div class="small" style="margin-top:10px">ÄÃ¢y lÃ  â€œloopâ€ kiá»ƒu sÃ¡ng táº¡o: báº¡n chÆ¡i vÃ¬ thÃ­ch palette, khÃ´ng pháº£i vÃ¬ bá»‹ Ã©p á»Ÿ láº¡i.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gentle break reminder (optional) -->
  <div id="breakCard" class="tc-toast" style="bottom: 62px;">Nháº¯c nháº¹: nghá»‰ máº¯t 20 giÃ¢y nhÃ© ğŸ‘€</div>


  <!-- World Gallery modal -->
  <div id="tcWorlds" class="modal hidden" role="dialog" aria-modal="true" aria-label="Choose your world">
    <div class="backdrop" id="closeBackdrop"></div>
    <div class="glass modalCard">
      <div class="modalHead">
        <div>
          <div class="title">ğŸª Choose your universe</div>
          <div class="sub">Hover Ä‘á»ƒ preview toÃ n trang â€¢ Click Ä‘á»ƒ Enter vÃ  lÆ°u lá»±a chá»n</div>
        </div>

        <div class="controls">
          <input id="q" class="search" placeholder="Search: ocean / arcade / minimal / cute..." />
          <button class="btn btn-ghost" id="clearQ" style="padding:10px 12px; border-radius:999px">Clear</button>
          <button class="btn btn-ghost" id="rand" style="padding:10px 12px; border-radius:999px">ğŸ² Random</button>
          <button class="btn btn-ghost" id="daily" style="padding:10px 12px; border-radius:999px">ğŸ—“ Daily</button>
          <button class="btn btn-ghost" id="favOnly" style="padding:10px 12px; border-radius:999px">â­ Favorites</button>
          <label class="tog"><input id="sound" type="checkbox"/> Sound</label>
          <button class="btn" id="closeModal" style="padding:10px 12px; border-radius:999px">Äá»ƒ sau</button>
        </div>
      </div>

      <div class="filters">
        <button class="fbtn active" data-f="all">All</button>
        <button class="fbtn" data-f="futuristic">Futuristic</button>
        <button class="fbtn" data-f="retro">Retro</button>
        <button class="fbtn" data-f="nature">Nature</button>
        <button class="fbtn" data-f="minimal">Minimal</button>
        <button class="fbtn" data-f="light">Light</button>
        <div style="margin-left:auto" class="chip"><span id="count">8</span> worlds</div>
      </div>

      <div class="grid" id="grid"></div>
    </div>
  </div>

  <script>
    (function(){
      const order = ["nebula","arcade","ink","ocean","dunes","chrome","crystal","origami"];
      const defs = [
        {id:"nebula", name:"ğŸŒŒ Nebula Gate", tags:["futuristic"], rarity:"Epic", desc:"Aurora + starfield â€¢ portal vibe", mini:"radial-gradient(circle at 18% 25%, rgba(34,211,238,.36), transparent 58%), radial-gradient(circle at 82% 20%, rgba(236,72,153,.26), transparent 60%), radial-gradient(circle at 60% 82%, rgba(139,92,246,.24), transparent 62%), #050816"},
        {id:"arcade", name:"ğŸ•¹ Pixel Arcade", tags:["retro"], rarity:"Rare", desc:"Scanlines + pixel grid â€¢ arcade energy", mini:"repeating-linear-gradient(0deg, rgba(255,255,255,.10) 0px, rgba(255,255,255,.04) 1px, transparent 4px, transparent 10px), repeating-linear-gradient(90deg, rgba(255,255,255,.08) 0px, rgba(255,255,255,.03) 1px, transparent 5px, transparent 14px), radial-gradient(circle at 20% 30%, rgba(255,64,196,.22), transparent 55%), radial-gradient(circle at 80% 30%, rgba(83,255,246,.18), transparent 62%), #0b0614"},
        {id:"ink", name:"ğŸ–‹ Ink Wash", tags:["minimal","light"], rarity:"Legendary", desc:"Paper + ink wash â€¢ editorial calm", mini:"radial-gradient(circle at 30% 40%, rgba(10,14,40,.12), transparent 60%), radial-gradient(circle at 75% 35%, rgba(10,14,40,.08), transparent 62%), #fbfbf7"},
        {id:"ocean", name:"ğŸŒŠ Underwater", tags:["nature","futuristic"], rarity:"Rare", desc:"Caustics light â€¢ deep color swim", mini:"radial-gradient(circle at 25% 30%, rgba(64,224,208,.22), transparent 62%), radial-gradient(circle at 75% 35%, rgba(59,130,246,.18), transparent 62%), #020b16"},
        {id:"dunes", name:"ğŸœ Desert Dunes", tags:["nature","retro"], rarity:"Uncommon", desc:"Warm dunes â€¢ cinematic sandwind", mini:"radial-gradient(circle at 50% 25%, rgba(245,208,118,.22), transparent 55%), radial-gradient(circle at 20% 75%, rgba(244,63,94,.12), transparent 62%), #120a08"},
        {id:"chrome", name:"ğŸª Liquid Chrome", tags:["futuristic","minimal"], rarity:"Epic", desc:"Liquid metal â€¢ premium sciâ€‘fi", mini:"conic-gradient(from 220deg at 30% 30%, rgba(255,255,255,.20), rgba(200,200,255,.10), rgba(255,255,255,.18), rgba(180,180,200,.10), rgba(255,255,255,.20)), #06060a"},
        {id:"crystal", name:"ğŸ’ Crystal Cave", tags:["futuristic"], rarity:"Epic", desc:"Prismatic shards â€¢ crystal hall", mini:"conic-gradient(from 180deg at 40% 40%, rgba(99,102,241,.20), transparent 25%, rgba(236,72,153,.16), transparent 55%, rgba(34,211,238,.16), transparent 80%), #040713"},
        {id:"origami", name:"ğŸ§© Origami City", tags:["light","minimal"], rarity:"Uncommon", desc:"Clean light â€¢ geometric product", mini:"linear-gradient(135deg, rgba(59,130,246,.12) 0%, transparent 45%), linear-gradient(225deg, rgba(239,68,68,.10) 0%, transparent 50%), #f7f8fb"},
      ];

      const modal = document.getElementById("tcWorlds");
      const grid = document.getElementById("grid");
      const q = document.getElementById("q");
      const count = document.getElementById("count");
      const btnFavOnly = document.getElementById("favOnly");
      const chkSound = document.getElementById("sound");
      const enter = document.getElementById("tcEnter");

      const FAV_KEY = "tc_world_favs";
      const SOUND_KEY = "tc_world_sound";

      let activeFilter = "all";
      let favOnly = false;

      function loadFavs(){ try{return JSON.parse(localStorage.getItem(FAV_KEY)||"[]")}catch(e){return[]} }
      function saveFavs(arr){ localStorage.setItem(FAV_KEY, JSON.stringify(arr)); }
      function isFav(w){ return loadFavs().includes(w); }

      function tick(kind){
        if(!chkSound || !chkSound.checked) return;
        try{
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = "sine";
          o.frequency.value = (kind==="enter") ? 220 : 440;
          g.gain.value = 0.06;
          o.connect(g); g.connect(ctx.destination);
          o.start();
          setTimeout(()=>{ o.stop(); ctx.close(); }, kind==="enter" ? 120 : 60);
        }catch(e){}
      }

      // Restore sound preference
      if(chkSound){
        chkSound.checked = (localStorage.getItem(SOUND_KEY)==="1");
        chkSound.addEventListener("change", ()=> localStorage.setItem(SOUND_KEY, chkSound.checked ? "1":"0"));
      }

      function openModal(){
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
        render();
      }
      function closeModal(){
        modal.classList.add("hidden");
        document.body.style.overflow = "";
        if(window.__tcApplyWorld && window.__tcGetWorld) __tcApplyWorld(__tcGetWorld());
      }

      function enterWorld(w){
        tick("enter");
        window.__tcSetWorld && __tcSetWorld(w);

        // animate enter
        enter.classList.remove("hidden");
        enter.classList.add("show");
        setTimeout(()=>{
          enter.classList.remove("show");
          enter.classList.add("hidden");
        }, 650);
      }

      function render(){
        const query = (q.value||"").trim().toLowerCase();
        const favs = loadFavs();

        grid.innerHTML = "";
        let shown = 0;

        defs.forEach(d=>{
          const matchTag = (activeFilter==="all") ? true : d.tags.includes(activeFilter);
          const matchQ = !query || d.name.toLowerCase().includes(query) || d.desc.toLowerCase().includes(query) || d.tags.some(t=>t.includes(query));
          const matchFav = !favOnly || favs.includes(d.id);
          if(!(matchTag && matchQ && matchFav)) return;

          shown++;

          const card = document.createElement("div");
          card.className = "card";
          card.setAttribute("data-world", d.id);

          const badge = document.createElement("div");
          badge.className = "badge";
          badge.textContent = d.rarity;
          card.appendChild(badge);

          const fav = document.createElement("div");
          fav.className = "fav" + (favs.includes(d.id) ? " active" : "");
          fav.textContent = "â˜…";
          fav.title = "Favorite";
          fav.addEventListener("click", (e)=>{
            e.preventDefault(); e.stopPropagation();
            const arr = loadFavs();
            const idx = arr.indexOf(d.id);
            if(idx>=0) arr.splice(idx,1); else arr.push(d.id);
            saveFavs(arr);
            tick("click");
            render();
          });
          card.appendChild(fav);

          const mini = document.createElement("div");
          mini.className = "mini";
          mini.style.background = d.mini;
          card.appendChild(mini);

          const name = document.createElement("div");
          name.className = "cname";
          name.textContent = d.name;
          card.appendChild(name);

          const desc = document.createElement("div");
          desc.className = "cdesc";
          desc.textContent = d.desc;
          card.appendChild(desc);

          // Hover preview
          card.addEventListener("mouseenter", ()=> window.__tcApplyWorld && __tcApplyWorld(d.id));
          card.addEventListener("mouseleave", ()=> window.__tcApplyWorld && window.__tcGetWorld && __tcApplyWorld(__tcGetWorld()));

          // Tilt
          card.addEventListener("mousemove", (e)=>{
            const r = card.getBoundingClientRect();
            const x = (e.clientX - r.left) / r.width;
            const y = (e.clientY - r.top) / r.height;
            const rx = (y - 0.5) * -8;
            const ry = (x - 0.5) * 10;
            card.style.transform = `translateY(-2px) rotateX(${rx}deg) rotateY(${ry}deg)`;
          });
          card.addEventListener("mouseleave", ()=>{
            card.style.transform = "";
          });

          card.addEventListener("click", ()=>{
            enterWorld(d.id);
            closeModal();
          });

          grid.appendChild(card);
        });

        count.textContent = String(shown);
      }

      // Filters
      document.querySelectorAll("[data-f]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          document.querySelectorAll("[data-f]").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          activeFilter = btn.getAttribute("data-f") || "all";
          render();
        });
      });

      // Search + clear
      q.addEventListener("input", render);
      document.getElementById("clearQ").addEventListener("click", ()=>{ q.value=""; q.focus(); render(); });

      // Favorites toggle
      btnFavOnly.addEventListener("click", ()=>{
        favOnly = !favOnly;
        btnFavOnly.textContent = favOnly ? "â­ Favorites (On)" : "â­ Favorites";
        tick("click");
        render();
      });

      // Random / daily (preview only)
      document.getElementById("rand").addEventListener("click", ()=>{
        const visible = defs.filter(d=>{
          const query = (q.value||"").trim().toLowerCase();
          const matchTag = (activeFilter==="all") ? true : d.tags.includes(activeFilter);
          const matchQ = !query || d.name.toLowerCase().includes(query) || d.desc.toLowerCase().includes(query) || d.tags.some(t=>t.includes(query));
          const matchFav = !favOnly || isFav(d.id);
          return matchTag && matchQ && matchFav;
        });
        if(!visible.length) return;
        const pick = visible[Math.floor(Math.random()*visible.length)];
        tick("click");
        window.__tcApplyWorld && __tcApplyWorld(pick.id);
      });

      document.getElementById("daily").addEventListener("click", ()=>{
        const d = new Date();
        const key = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
        let h = 0; for(let i=0;i<key.length;i++) h = (h*31 + key.charCodeAt(i)) >>> 0;
        const w = order[h % order.length];
        tick("click");
        window.__tcApplyWorld && __tcApplyWorld(w);
      });

      // Close modal
      document.getElementById("closeModal").addEventListener("click", closeModal);
      document.getElementById("closeBackdrop").addEventListener("click", closeModal);
      document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeModal(); });

      // Open modal buttons
      document.getElementById("tryGallery").addEventListener("click", openModal);
      document.getElementById("openGallery").addEventListener("click", openModal);

      // First visit auto-open
      const url = new URLSearchParams(location.search);
      const urlWorld = url.get("world") || url.get("theme");
      if(window.__tcHasSavedWorld && !__tcHasSavedWorld() && !urlWorld){
        openModal();
      }

      // Header worlds menu
      const btn = document.getElementById("worldBtn");
      const menu = document.getElementById("worldMenu");
      function closeMenu(){ menu.classList.add("hidden"); }
      btn.addEventListener("click", ()=> menu.classList.toggle("hidden"));
      document.addEventListener("click", (e)=>{
        if(menu.classList.contains("hidden")) return;
        if(btn.contains(e.target) || menu.contains(e.target)) return;
        closeMenu();
      });
      menu.querySelectorAll("[data-w]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const w = b.getAttribute("data-w");
          window.__tcSetWorld && __tcSetWorld(w);
          closeMenu();
        });
      });
      document.getElementById("resetWorld").addEventListener("click", ()=>{
        window.__tcClearWorld && __tcClearWorld();
        closeMenu();
      });

      // Mobile cycle
      document.getElementById("mobileWorld").addEventListener("click", ()=>{
        const cur = window.__tcGetWorld ? __tcGetWorld() : "nebula";
        const idx = order.indexOf(cur);
        const next = order[(idx+1) % order.length];
        window.__tcSetWorld && __tcSetWorld(next);
      });

      // Spotlight in core card
      const core = document.getElementById("coreCard");
      const spot = document.getElementById("spot");
      core.addEventListener("mousemove", (e)=>{
        const r = core.getBoundingClientRect();
        const x = ((e.clientX - r.left) / r.width) * 100;
        const y = ((e.clientY - r.top) / r.height) * 100;
        spot.style.setProperty("--mx", x + "%");
        spot.style.setProperty("--my", y + "%");
      });

      // Swatch animation (just to show life)
      const swatch = document.getElementById("heroSwatch");
      const hexEl = document.getElementById("heroHex");
      const hexes = ["#22d3ee","#ec4899","#8b5cf6","#3b82f6","#10b981","#f59e0b","#f43f5e","#a3e635"];
      let i = 0;
      setInterval(()=>{
        i = (i+1) % hexes.length;
        const hx = hexes[i];
        hexEl.textContent = hx;
        // use a soft gradient tied to current world tokens (safe)
        swatch.style.background = `linear-gradient(135deg, rgba(var(--a1),.26), rgba(var(--a2),.18), rgba(var(--a3),.16))`;
      }, 2200);
    
      /* ==================== v3 loop helpers ==================== */
      const SEEN_KEY = "tc_world_seen";
      const DAILY_KEY_PREFIX = "tc_daily_stamp_";
      const ROULETTE_KEY = "tc_roulette_saves";

      const toast = document.getElementById("tcToast");
      function showToast(msg){
        if(!toast) return;
        toast.textContent = msg;
        toast.classList.add("show");
        clearTimeout(showToast._t);
        showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
      }

      function loadSeen(){
        try{ return JSON.parse(localStorage.getItem(SEEN_KEY) || "[]"); }catch(e){ return []; }
      }
      function saveSeen(arr){ localStorage.setItem(SEEN_KEY, JSON.stringify(arr)); }
      function markSeen(w){
        const arr = loadSeen();
        if(!arr.includes(w)){
          arr.push(w);
          saveSeen(arr);
          updateCollectionUI();
        }
      }
      function updateCollectionUI(){
        const arr = loadSeen();
        const n = arr.length;
        const bar = document.getElementById("seenBar");
        const txt = document.getElementById("seenText");
        if(bar) bar.style.width = Math.min(100, (n/8)*100) + "%";
        if(txt) txt.textContent = String(n);
      }

      // Update on load
      updateCollectionUI();

      // Mark current world as seen
      if(window.__tcGetWorld) markSeen(__tcGetWorld());

      // Roulette modal
      const openRouletteBtn = document.getElementById("openRoulette");
      const rouletteModal = document.getElementById("rouletteModal");
      const rouletteClose = document.getElementById("rouletteClose");
      const rouletteCloseBack = document.getElementById("rouletteCloseBack");
      const roulettePreview = document.getElementById("roulettePreview");
      const rouletteCss = document.getElementById("rouletteCss");
      const rouletteStops = document.getElementById("rouletteStops");
      const rouletteVibe = document.getElementById("rouletteVibe");
      const rouletteThread = document.getElementById("rouletteThread");
      const rouletteSpin = document.getElementById("rouletteSpin");
      const rouletteSpinSoft = document.getElementById("rouletteSpinSoft");
      const rouletteCopy = document.getElementById("rouletteCopy");
      const rouletteSave = document.getElementById("rouletteSave");

      function openRoulette(){
        rouletteModal?.classList.remove("hidden");
        document.body.style.overflow = "hidden";
        spinRoulette(false);
      }
      function closeRoulette(){
        rouletteModal?.classList.add("hidden");
        document.body.style.overflow = "";
      }
      openRouletteBtn?.addEventListener("click", openRoulette);
      rouletteClose?.addEventListener("click", closeRoulette);
      rouletteCloseBack?.addEventListener("click", closeRoulette);

      // Color helpers
      function randInt(a,b){ return Math.floor(a + Math.random()*(b-a+1)); }
      function hslToHex(h,s,l){
        s/=100; l/=100;
        const k = n => (n + h/30) % 12;
        const a = s * Math.min(l, 1-l);
        const f = n => l - a * Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n), 1)));
        const toHex = x => Math.round(255*x).toString(16).padStart(2,"0");
        return "#" + toHex(f(0)) + toHex(f(8)) + toHex(f(4));
      }

      const vibes = [
        {name:"Neon candy", thread:"Gingko Y3199 (mock)"},
        {name:"Deep ocean", thread:"Ming Shyang 233 (mock)"},
        {name:"Retro synth", thread:"Anchor 260 (mock)"},
        {name:"Crystal pop", thread:"DMC 550 (mock)"},
        {name:"Sunset dunes", thread:"Gingko Y2708 (mock)"},
        {name:"Clean pro", thread:"Isacord 0015 (mock)"}
      ];

      let lastGradient = "";
      function makeGradient(soft){
        const w = window.__tcGetWorld ? __tcGetWorld() : "nebula";
        let baseH;
        switch(w){
          case "ocean": baseH = randInt(165, 215); break;
          case "dunes": baseH = randInt(10, 40); break;
          case "arcade": baseH = randInt(270, 330); break;
          case "ink": baseH = randInt(190, 220); break;
          case "chrome": baseH = randInt(190, 260); break;
          case "crystal": baseH = randInt(230, 310); break;
          case "origami": baseH = randInt(35, 55); break;
          default: baseH = randInt(180, 290);
        }
        const spread = soft ? randInt(30, 70) : randInt(60, 140);
        const s1 = soft ? randInt(55, 75) : randInt(70, 95);
        const s2 = soft ? randInt(45, 70) : randInt(60, 92);
        const s3 = soft ? randInt(45, 70) : randInt(60, 92);
        const l1 = soft ? randInt(52, 70) : randInt(48, 62);
        const l2 = soft ? randInt(45, 62) : randInt(40, 56);
        const l3 = soft ? randInt(48, 68) : randInt(42, 58);

        const h1 = (baseH + randInt(-10,10) + 360) % 360;
        const h2 = (baseH + spread + randInt(-12,12) + 360) % 360;
        const h3 = (baseH + spread*2 + randInt(-12,12) + 360) % 360;

        const c1 = hslToHex(h1, s1, l1);
        const c2 = hslToHex(h2, s2, l2);
        const c3 = hslToHex(h3, s3, l3);

        const a = randInt(120, 160);
        lastGradient = `linear-gradient(${a}deg, ${c1}, ${c2}, ${c3})`;
        return {c1,c2,c3,css:lastGradient};
      }

      function spinRoulette(soft){
        const g = makeGradient(!!soft);
        if(roulettePreview) roulettePreview.style.background = g.css;
        if(rouletteCss) rouletteCss.textContent = g.css;
        if(rouletteStops) rouletteStops.textContent = `${g.c1} â€¢ ${g.c2} â€¢ ${g.c3}`;
        const v = vibes[Math.floor(Math.random()*vibes.length)];
        if(rouletteVibe) rouletteVibe.textContent = v.name;
        if(rouletteThread) rouletteThread.textContent = v.thread;
        showToast(soft ? "Soft spin âœ¨" : "Spin âœ¨");
      }

      rouletteSpin?.addEventListener("click", ()=>spinRoulette(false));
      rouletteSpinSoft?.addEventListener("click", ()=>spinRoulette(true));

      function copyText(t){
        try{
          navigator.clipboard.writeText(t);
          showToast("Copied!");
        }catch(e){
          showToast("Copy failed");
        }
      }
      rouletteCopy?.addEventListener("click", ()=> copyText(lastGradient || (rouletteCss?.textContent||"")));
      rouletteCss?.addEventListener("click", ()=> copyText(rouletteCss.textContent));

      rouletteSave?.addEventListener("click", ()=>{
        try{
          const arr = JSON.parse(localStorage.getItem(ROULETTE_KEY) || "[]");
          const item = { css: lastGradient || (rouletteCss?.textContent||""), ts: Date.now(), world: (window.__tcGetWorld?__tcGetWorld():"nebula") };
          arr.unshift(item);
          localStorage.setItem(ROULETTE_KEY, JSON.stringify(arr.slice(0, 60)));
          showToast("Saved to local âœ…");
        }catch(e){
          showToast("Save failed");
        }
      });

      // Daily stamp (opt-in, 1 per day)
      const claimDaily = document.getElementById("claimDaily");
      claimDaily?.addEventListener("click", ()=>{
        const d = new Date();
        const key = DAILY_KEY_PREFIX + d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();
        const seenCount = loadSeen().length;
        if(seenCount < 8){
          showToast("Discover all 8 worlds first âœ¨");
          return;
        }
        if(localStorage.getItem(key)){
          showToast("Already claimed today âœ…");
          return;
        }
        localStorage.setItem(key, "1");
        showToast("Daily stamp claimed ğŸ—“");
      });

      // Reset loop (for sanity)
      const clearLoop = document.getElementById("clearLoop");
      clearLoop?.addEventListener("click", ()=>{
        localStorage.removeItem(SEEN_KEY);
        localStorage.removeItem("tc_world_favs");
        localStorage.removeItem("tc_roulette_saves");
        showToast("Loop reset ğŸ§¹");
        updateCollectionUI();
      });

      // Mark worlds as seen on hover (gallery cards)
      // and pointer spotlight vars
      function hookCardsForSeenAndSpotlight(){
        const cards = [...document.querySelectorAll("#grid .card")];
        cards.forEach(card=>{
          const w = card.getAttribute("data-world");
          if(!w) return;
          let t;
          card.addEventListener("mouseenter", ()=>{
            t = setTimeout(()=> markSeen(w), 420);
          });
          card.addEventListener("mouseleave", ()=> clearTimeout(t));
          card.addEventListener("mousemove", (e)=>{
            const r = card.getBoundingClientRect();
            const x = ((e.clientX - r.left) / r.width) * 100;
            const y = ((e.clientY - r.top) / r.height) * 100;
            card.style.setProperty("--px", x + "%");
            card.style.setProperty("--py", y + "%");
          });
        });
      }

      // Wrap render to re-hook after filters/search
      const _render = render;
      render = function(){
        _render();
        hookCardsForSeenAndSpotlight();
      };
      hookCardsForSeenAndSpotlight();

})();
  </script>

<script>
(function(){
  // --- Subtle background parallax ---
  const root = document.documentElement;
  let raf = null;
  let tx = 0, ty = 0;
  function onMove(e){
    const w = window.innerWidth || 1;
    const h = window.innerHeight || 1;
    const dx = (e.clientX - w/2) * 0.02; // subtle
    const dy = (e.clientY - h/2) * 0.02;
    tx = dx; ty = dy;
    if(raf) return;
    raf = requestAnimationFrame(()=>{
      root.style.setProperty("--pdx", tx.toFixed(2) + "px");
      root.style.setProperty("--pdy", ty.toFixed(2) + "px");
      raf = null;
    });
  }
  window.addEventListener("mousemove", onMove, {passive:true});

  // --- Palette Forge ---
  const forgeModal = document.getElementById("forgeModal");
  const forgeClose = document.getElementById("forgeClose");
  const forgeCloseBack = document.getElementById("forgeCloseBack");
  const openForge = document.getElementById("openForge");
  const forgePreview = document.getElementById("forgePreview");
  const forgeSwatches = document.getElementById("forgeSwatches");
  const forgeFromGradient = document.getElementById("forgeFromGradient");
  const forgeShuffle = document.getElementById("forgeShuffle");
  const forgeCopyHex = document.getElementById("forgeCopyHex");
  const forgeCopyJson = document.getElementById("forgeCopyJson");
  const forgeSave = document.getElementById("forgeSave");
  const forgeViewSaves = document.getElementById("forgeViewSaves");
  const forgeSource = document.getElementById("forgeSource");

  const PALETTE_KEY = "tc_palettes_v1";
  // Reuse roulette gradient if available (created in the big script)
  function getLastGradient(){
    // try to read from roulette css node
    const node = document.getElementById("rouletteCss");
    const css = node?.textContent?.trim();
    if(css && css.startsWith("linear-gradient")) return css;
    // fallback to world button background gradient tokens
    return `linear-gradient(135deg, rgba(var(--a1),.28), rgba(var(--a2),.20), rgba(var(--a3),.18))`;
  }

  function hexToRgb(hex){
    const h = (hex || "").replace("#","").trim();
    if(h.length !== 6) return null;
    const r = parseInt(h.slice(0,2),16);
    const g = parseInt(h.slice(2,4),16);
    const b = parseInt(h.slice(4,6),16);
    if([r,g,b].some(n=>Number.isNaN(n))) return null;
    return {r,g,b};
  }
  function rgbToHex(r,g,b){
    const to = (n)=> Math.max(0,Math.min(255,Math.round(n))).toString(16).padStart(2,"0");
    return "#" + to(r) + to(g) + to(b);
  }
  function lerp(a,b,t){ return a + (b-a)*t; }
  function mix(ca, cb, t){
    const a = hexToRgb(ca), b = hexToRgb(cb);
    if(!a || !b) return ca;
    return rgbToHex(lerp(a.r,b.r,t), lerp(a.g,b.g,t), lerp(a.b,b.b,t));
  }

  // Try to parse first 3 hex colors from a linear-gradient string
  function parseStops(grad){
    const m = (grad || "").match(/#([0-9a-fA-F]{6})/g);
    if(m && m.length >= 3) return [m[0], m[1], m[2]];
    return null;
  }

  function paletteFromStops(stops){
    // create 5 colors across 2 segments
    const [c1,c2,c3] = stops;
    return [c1, mix(c1,c2,0.5), c2, mix(c2,c3,0.5), c3];
  }

  // fallback palette from world tokens (not random dark-pattern)
  function paletteFromTokens(){
    // use token colors (approx)
    const a1 = getComputedStyle(root).getPropertyValue("--a1").trim(); // "r,g,b"
    const a2 = getComputedStyle(root).getPropertyValue("--a2").trim();
    const a3 = getComputedStyle(root).getPropertyValue("--a3").trim();
    function rgbStrToHex(s){
      const parts = s.split(",").map(x=>parseInt(x.trim(),10));
      if(parts.length !== 3 || parts.some(n=>Number.isNaN(n))) return "#22d3ee";
      return rgbToHex(parts[0], parts[1], parts[2]);
    }
    const c1 = rgbStrToHex(a1);
    const c2 = rgbStrToHex(a2);
    const c3 = rgbStrToHex(a3);
    return paletteFromStops([c1,c2,c3]);
  }

  function setForge(palette, gradientCss, sourceLabel){
    if(forgePreview) forgePreview.style.background = gradientCss;
    if(forgeSource) forgeSource.textContent = sourceLabel || "Current gradient";
    if(!forgeSwatches) return;
    forgeSwatches.innerHTML = "";
    palette.forEach((hx)=>{
      const b = document.createElement("button");
      b.className = "glass";
      b.style.padding = "10px";
      b.style.borderRadius = "18px";
      b.style.display = "flex";
      b.style.flexDirection = "column";
      b.style.gap = "8px";
      b.style.cursor = "pointer";
      const sw = document.createElement("div");
      sw.style.height = "56px";
      sw.style.borderRadius = "14px";
      sw.style.border = "1px solid var(--stroke)";
      sw.style.background = hx;
      const t = document.createElement("div");
      t.className = "mono";
      t.style.fontSize = "12px";
      t.style.opacity = ".9";
      t.textContent = hx.toUpperCase();
      b.appendChild(sw);
      b.appendChild(t);
      b.addEventListener("click", ()=>{
        try{ navigator.clipboard.writeText(hx.toUpperCase()); }catch(e){}
        const toast = window.showToast || null;
        if(typeof toast === "function") toast("Copied " + hx.toUpperCase());
        else {
          const el = document.getElementById("tcToast");
          if(el){ el.textContent = "Copied " + hx.toUpperCase(); el.classList.add("show"); setTimeout(()=>el.classList.remove("show"), 1100); }
        }
      });
      forgeSwatches.appendChild(b);
    });
  }

  function openForgeModal(){
    forgeModal?.classList.remove("hidden");
    document.body.style.overflow = "hidden";
    const grad = getLastGradient();
    const stops = parseStops(grad);
    const pal = stops ? paletteFromStops(stops) : paletteFromTokens();
    setForge(pal, grad, "Current gradient");
  }
  function closeForgeModal(){
    forgeModal?.classList.add("hidden");
    document.body.style.overflow = "";
  }
  openForge?.addEventListener("click", openForgeModal);
  forgeClose?.addEventListener("click", closeForgeModal);
  forgeCloseBack?.addEventListener("click", closeForgeModal);

  forgeFromGradient?.addEventListener("click", ()=>{
    const grad = getLastGradient();
    const stops = parseStops(grad);
    const pal = stops ? paletteFromStops(stops) : paletteFromTokens();
    setForge(pal, grad, "Current gradient âœ¨");
    if(window.showToast) window.showToast("Forged âœ¨");
  });

  forgeShuffle?.addEventListener("click", ()=>{
    // If roulette exists, trigger a spin softly then forge
    const soft = document.getElementById("rouletteSpinSoft");
    if(soft) soft.click();
    const grad = getLastGradient();
    const stops = parseStops(grad);
    const pal = stops ? paletteFromStops(stops) : paletteFromTokens();
    setForge(pal, grad, "Shuffled");
    if(window.showToast) window.showToast("Shuffle âœ¨");
  });

  function copyText(t){
    try{ navigator.clipboard.writeText(t); if(window.showToast) window.showToast("Copied!"); }catch(e){ if(window.showToast) window.showToast("Copy failed"); }
  }
  forgeCopyHex?.addEventListener("click", ()=>{
    const hexes = [...forgeSwatches.querySelectorAll(".mono")].map(n=>n.textContent.trim()).filter(Boolean);
    copyText(hexes.join("\n"));
  });
  forgeCopyJson?.addEventListener("click", ()=>{
    const hexes = [...forgeSwatches.querySelectorAll(".mono")].map(n=>n.textContent.trim()).filter(Boolean);
    const payload = { palette: hexes, world: (window.__tcGetWorld?__tcGetWorld():"nebula"), ts: Date.now() };
    copyText(JSON.stringify(payload, null, 2));
  });

  forgeSave?.addEventListener("click", ()=>{
    const hexes = [...forgeSwatches.querySelectorAll(".mono")].map(n=>n.textContent.trim()).filter(Boolean);
    const item = { palette: hexes, world: (window.__tcGetWorld?__tcGetWorld():"nebula"), gradient: getLastGradient(), ts: Date.now() };
    try{
      const arr = JSON.parse(localStorage.getItem(PALETTE_KEY) || "[]");
      arr.unshift(item);
      localStorage.setItem(PALETTE_KEY, JSON.stringify(arr.slice(0, 80)));
      if(window.showToast) window.showToast("Saved palette âœ…");
    }catch(e){
      if(window.showToast) window.showToast("Save failed");
    }
  });

  forgeViewSaves?.addEventListener("click", ()=>{
    try{
      const arr = JSON.parse(localStorage.getItem(PALETTE_KEY) || "[]");
      if(!arr.length){ if(window.showToast) window.showToast("No saves yet"); return; }
      const latest = arr[0];
      setForge(latest.palette, latest.gradient || getLastGradient(), "Saved (latest)");
      if(window.showToast) window.showToast("Loaded latest âœ…");
    }catch(e){
      if(window.showToast) window.showToast("Load failed");
    }
  });

  // --- Gentle break reminder (opt-in by user action: only after opening modal/roulette/forge at least once) ---
  const breakCard = document.getElementById("breakCard");
  let engaged = false;
  ["openRoulette","openForge","tryGallery"].forEach(id=>{
    document.getElementById(id)?.addEventListener("click", ()=> engaged = true);
  });
  let t0 = Date.now();
  setInterval(()=>{
    if(!engaged) return;
    const mins = (Date.now() - t0) / 60000;
    if(mins > 8 && breakCard && !breakCard.classList.contains("show")){
      breakCard.classList.add("show");
      setTimeout(()=>breakCard.classList.remove("show"), 2200);
      t0 = Date.now(); // reset
    }
  }, 30000);

})();
</script>

</body>
</html>
